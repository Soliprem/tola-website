/* ==========================================================================
   1. VARIABLES & THEME CONFIGURATION
   ========================================================================== */
@import "./themes/everforest-hard.css";

/* Dark Mode Media Fixes */
@media (prefers-color-scheme: dark) {
  [role="math"] :is(img, svg, canvas, picture, video, object, embed) {
    filter: invert(1) hue-rotate(180deg);
  }
}

/* ==========================================================================
   2. GLOBAL LAYOUT & TYPOGRAPHY
   ========================================================================== */

body {
  @apply leading-relaxed;
  background-color: var(--bg-body);
  color: var(--text-main);
  font-family: var(--font-serif);
}

main,
article {
  @apply max-w-3xl mx-auto px-6 py-12;
  position: relative;
}

/* Expansion for Sidenotes on Desktop */
@media (min-width: 1280px) {
  body {
    overflow-x: visible;
  }

  main,
  article {
    padding-right: 18rem;
    /* pr-72 equivalent */
    max-width: 48rem;
  }
}

/* --- Headings --- */
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: var(--font-sans);
  color: var(--text-head);
}

h1 {
  @apply text-4xl md:text-5xl font-bold mb-6 mt-8 leading-tight;
}

h2 {
  @apply text-3xl md:text-4xl font-bold mb-4 mt-10 leading-snug pb-2;
  color: var(--text-main);
  border-bottom: 2px solid var(--border-light);
}

h3 {
  @apply text-2xl md:text-3xl font-semibold mb-3 mt-8;
}

/* Smaller headings use slightly dimmer text */
h4,
h5 {
  color: var(--text-body);
}

h4 {
  @apply text-xl md:text-2xl font-semibold mb-2 mt-6;
}

h5 {
  @apply text-lg md:text-xl font-semibold mb-2 mt-4;
}

h6 {
  @apply text-base md:text-lg font-semibold mb-2 mt-4;
  color: var(--text-body);
}

/* --- Text Elements --- */
p {
  @apply mb-4 text-lg;
  color: var(--text-body);
}

li {
  @apply text-lg;
  color: var(--text-body);
}

small {
  @apply text-sm;
  color: var(--text-faint);
}

strong {
  @apply font-bold;
  color: var(--text-head);
}

em {
  @apply italic;
}

/* Links */
a {
  color: var(--accent-primary);
  text-decoration-color: var(--accent-decoration);
  @apply underline transition-colors duration-200;
}

a:hover {
  color: var(--accent-hover);
  text-decoration-color: var(--accent-primary);
}

/* Lists */
ul {
  @apply list-disc list-inside mb-4 space-y-2 ml-4;
  color: var(--text-body);
}

ol {
  @apply list-decimal list-inside mb-4 space-y-2 ml-4;
  color: var(--text-body);
}

li>ul,
li>ol {
  @apply mt-2 ml-6;
}

/* Selection & Scrollbar */
::selection {
  background-color: var(--accent-decoration);
  color: white;
}

::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background-color: var(--bg-body);
}

::-webkit-scrollbar-thumb {
  background-color: var(--border-light);
  border-radius: 9999px;
}

::-webkit-scrollbar-thumb:hover {
  background-color: var(--text-faint);
}


/* ==========================================================================
   3. SITE HEADER & FOOTER
   ========================================================================== */

header {
  @apply shadow-lg top-0 z-50 rounded-b-md;
  background-color: var(--bg-header);
  border-bottom: 1px solid var(--border-main);
  padding: 1em;
}

header nav {
  @apply max-w-3xl mx-auto px-6 py-4 flex justify-between items-center;
}

header a {
  @apply no-underline font-medium;
  color: var(--text-body);
}

header a:hover {
  color: var(--text-main);
}

footer {
  @apply mt-16 py-8 text-center text-sm;
  background-color: var(--bg-header);
  border-top: 1px solid var(--border-main);
  color: var(--text-muted);
}


/* ==========================================================================
   4. CONTENT BLOCKS (Images, Tables, Code)
   ========================================================================== */

/* Blockquotes */
blockquote {
  @apply pl-6 py-2 my-6 italic rounded-r;
  border-left: 4px solid var(--accent-primary);
  /* blue-500 */
  background-color: var(--bg-surface);
  color: var(--text-muted);
}

/* Code Blocks */
pre {
  @apply rounded-lg p-6 mb-4 overflow-x-auto text-sm leading-relaxed shadow-xl;
  background-color: var(--bg-code);
  color: var(--text-main);
  border: 1px solid var(--border-main);
}

/* Inline Code */
code {
  @apply px-2 py-1 rounded text-sm;
  background-color: var(--bg-surface);
  color: var(--accent-code);
  font-family: var(--font-mono);
}

pre code {
  background-color: transparent;
  color: var(--text-main);
  padding: 0;
}

/* Tables */
table {
  @apply w-full border-collapse mb-6 shadow-lg;
}

thead {
  background-color: var(--bg-surface);
  color: var(--text-main);
}

th {
  @apply px-4 py-3 text-left font-semibold;
  border: 1px solid var(--border-light);
}

td {
  @apply px-4 py-3;
  border: 1px solid var(--border-light);
  color: var(--text-body);
}

tbody tr {
  @apply transition-colors;
  background-color: var(--bg-body);
}

tbody tr:hover {
  background-color: var(--bg-surface);
}

tbody tr:nth-child(even) {
  background-color: var(--bg-surface);
}

/* Images & Figures */
img {
  @apply max-w-full h-auto rounded-lg shadow-xl my-6;
  border: 1px solid var(--border-main);
}

figure {
  @apply my-8;
}

figcaption {
  @apply text-center text-sm italic mt-2;
  color: var(--text-muted);
}

hr {
  @apply my-8;
  border-top: 2px solid var(--border-light);
}

dl {
  @apply mb-4;
}

dt {
  @apply font-semibold mt-4;
  color: var(--text-main);
}

dd {
  @apply ml-6;
  color: var(--text-body);
}


/* ==========================================================================
   5. COMPONENT: TERMINAL NAVBAR
   ========================================================================== */

.terminal-nav {
  display: flex;
  flex-wrap: wrap;
  align-items: baseline;
  gap: 1.5rem;
  padding: 2rem 0 0.5rem 0;
  margin-bottom: 3rem;
  font-family: var(--font-mono);
  font-size: 0.9rem;
  position: sticky;
  top: 0;
  z-index: 50;
  background-color: var(--bg-body);
}

.terminal-nav p {
  margin: 0;
  font-size: inherit;
  line-height: inherit;
  display: inline;
}

/* --- Desktop Layout (Default) --- */

/* Use display: contents to let the prompt participate in the flex grid 
   directly on supported browsers, or fallback to block/flex if needed. */
.nav-header {
  display: contents;
}

.terminal-prompt {
  color: var(--text-faint);
  font-weight: normal;
  user-select: none;
}

/* Hide the toggle controls on desktop */
.nav-toggle-input,
.nav-toggle-label {
  display: none;
}

.terminal-links {
  display: flex;
  gap: 1.5rem;
  align-items: center;
}

.terminal-nav a {
  color: var(--text-muted);
  text-decoration: none;
  position: relative;
  transition: color 0.2s;
}

.terminal-nav a:hover {
  color: var(--accent-success);
}

.terminal-nav a:hover::before {
  content: "";
  color: var(--accent-cursor);
  position: absolute;
  left: -0.8em;
  font-weight: bold;
}

/* Footnote toggle button style */
.fn-toggle-btn {
  background: none;
  border: none;
  padding: 0;
  font-family: inherit;
  font-size: inherit;
  cursor: pointer;
  color: var(--accent-primary);
  opacity: 0.8;
  transition: opacity 0.2s;
}

.fn-toggle-btn:hover {
  opacity: 1;
  text-decoration: underline;
}


/* --- Mobile Adjustments (Checkbox Hack) --- */
@media (max-width: 640px) {
  .terminal-nav {
    flex-direction: column;
    align-items: stretch;
    gap: 0;
    margin-bottom: 2rem;
  }

  /* Header becomes a flex row for Prompt and Button */
  .nav-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    margin-bottom: 0.5rem;
  }

  /* Show the toggle button */
  .nav-toggle-label {
    display: inline-block;
    cursor: pointer;
    color: var(--accent-primary);
    user-select: none;
  }

  .nav-toggle-label:hover {
    text-decoration: underline;
  }

  /* Hide links by default */
  .terminal-links {
    display: none;
    flex-direction: column;
    align-items: flex-start;
    padding-left: 1rem;
    gap: 0.75rem;
    border-left: 1px solid var(--border-main);
    margin-top: 0.5rem;
  }

  /* Logic: When checkbox is checked, show links */
  .nav-toggle-input:checked~.terminal-links {
    display: flex;
  }

  /* Change label text content purely via CSS if desired, 
     or just keep it simple with the HTML text */
  .nav-toggle-input:checked~.nav-header .nav-toggle-label {
    color: var(--text-main);
  }

  .terminal-nav a:hover::before {
    display: none;
  }
}


/* ==========================================================================
   6. COMPONENT: SIDENOTES / FOOTNOTES
   ========================================================================== */

.sidenote-wrapper {
  position: relative;
  color: var(--accent-primary);
  cursor: pointer;
  text-decoration: underline;
  text-decoration-style: dotted;
}

/* --- State 1: Default Mobile (Tooltip) --- */
.sidenote-content {
  visibility: hidden;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s, visibility 0.2s;

  position: absolute;
  bottom: 150%;
  left: 50%;
  transform: translateX(-50%);
  z-index: 50;

  width: max-content;
  max-width: 18rem;
  padding: 0.75rem;

  background-color: var(--bg-surface);
  color: var(--text-main);
  border: 1px solid var(--border-light);
  border-radius: 0.5rem;
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);

  font-size: 0.875rem;
  line-height: 1.4;
  text-align: left;
  font-weight: normal;
  text-decoration: none;
}

/* Tooltip Arrow */
.sidenote-content::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -6px;
  border-width: 6px;
  border-style: solid;
  border-color: var(--bg-surface) transparent transparent transparent;
}

/* Show Tooltip */
.sidenote-wrapper:hover .sidenote-content,
.sidenote-wrapper:focus .sidenote-content {
  visibility: visible;
  opacity: 1;
  pointer-events: auto;
}

/* --- State 2: Mobile Toggled (Inline Block) --- */
body.inline-notes .sidenote-wrapper {
  text-decoration: none;
}

body.inline-notes .sidenote-content {
  visibility: visible;
  opacity: 1;
  pointer-events: auto;

  position: static;
  transform: none;
  display: block;

  margin: 1rem 0;
  padding: 0.75rem;
  width: 100%;
  max-width: none;

  background-color: var(--bg-surface);
  border: none;
  border-left: 3px solid var(--accent-primary);
  /* blue-500 */
  border-radius: 0 0.25rem 0.25rem 0;
  box-shadow: none;
}

body.inline-notes .sidenote-content::after {
  display: none;
}


/* --- State 3: Desktop Sidenotes (Overrides Mobile) --- */
@media (min-width: 1280px) {

  /* Hide Mobile Toggle Button */
  .fn-toggle-btn {
    display: none !important;
  }

  /* Reset Wrapper */
  .sidenote-wrapper {
    cursor: auto;
    text-decoration: none;
    color: inherit;
  }

  .sidenote-wrapper sup {
    color: var(--accent-primary);
    font-weight: bold;
  }

  /* Force Sidenote Style */
  .sidenote-content,
  body.inline-notes .sidenote-content {
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto;

    position: static;
    transform: none;
    display: block;

    float: right;
    clear: right;
    width: 15rem;
    margin-right: -17rem;
    /* Pushes into the right padding defined in Main */
    margin-top: 0;
    margin-bottom: 0.5rem;

    background-color: transparent;
    border: none;
    box-shadow: none;
    padding: 0;

    color: var(--text-muted);
    font-size: 0.8rem;
    text-align: left;
  }

  .sidenote-content::after {
    display: none;
  }
}


/* ==========================================================================
   7. COMPONENT: COLLAPSIBLE TOC
   ========================================================================== */

.toc-wrapper {
  margin: 2rem 0;
  border: 1px dashed var(--border-light);
  border-radius: 0.25rem;
  background-color: var(--bg-body);
  font-family: var(--font-mono);
  font-size: 0.9rem;
}

.toc-header {
  padding: 0.75rem 1rem;
  cursor: pointer;
  color: var(--text-muted);
  background-color: var(--bg-surface);
  display: flex;
  justify-content: space-between;
  align-items: center;
  user-select: none;
  transition: color 0.2s, background-color 0.2s;

  list-style: none;
  /* Hide default triangle */
}

.toc-header::-webkit-details-marker {
  display: none;
}

.toc-header:hover {
  color: var(--text-main);
  /* gray-200 equivalent */
  background-color: var(--border-light);
}

/* Toggle Indicator */
.toc-header::after {
  content: "[hide]";
  color: var(--accent-primary);
}

.toc-wrapper:not([open]) .toc-header::after {
  content: "[show]";
  color: var(--accent-success);
}

.toc-content {
  padding: 1rem;
  border-top: 1px dashed var(--border-light);
}

.toc-content ul {
  list-style: none;
  margin: 0;
  padding: 0;
  margin-left: 0 !important;
}

.toc-content li {
  margin-bottom: 0.5rem;
  padding-left: 0;
}

/* TOC Links */
.toc-content a {
  text-decoration: none;
  color: var(--text-muted);
  border-bottom: 1px dotted var(--border-light);
  transition: color 0.2s, border-color 0.2s;
}

.toc-content a:hover {
  color: var(--accent-primary);
  border-color: var(--accent-primary);
}

/* Animation */
.toc-wrapper[open] .toc-content {
  animation: toc-reveal 0.3s ease-out;
}

@keyframes toc-reveal {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ==========================================================================
   8. RESPONSIVE UTILITIES
   ========================================================================== */

@media (max-width: 640px) {

  body,
  p,
  li {
    font-size: 1rem;
  }
}

/* FIXME: this probably should be done differently*/
section[role="doc-endnotes"] {
  display: none !important;
}
